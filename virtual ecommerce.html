<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual E-Commerce Assistant</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #4CAF50;
            color: white;
            padding: 15px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        
        h1, h2, h3 {
            margin: 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: none;
            outline: none;
            transition: 0.3s;
        }
        
        .tab:hover {
            background-color: #ddd;
        }
        
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: white;
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .product-card img {
            max-width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .product-card h3 {
            margin: 10px 0;
        }
        
        .product-card .price {
            font-weight: bold;
            color: #4CAF50;
            font-size: 18px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .cart-total {
            font-weight: bold;
            font-size: 18px;
            text-align: right;
            margin-top: 20px;
        }
        
        .payment-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .order-success {
            text-align: center;
            padding: 40px;
            background-color: #e8f5e9;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .order-success h2 {
            color: #4CAF50;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: red;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Virtual E-Commerce Assistant</h1>
            <p>Connect businesses with customers seamlessly</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'businessTab')">Business Owner</button>
            <button class="tab" onclick="openTab(event, 'customerTab')">Customer</button>
            <button class="tab" onclick="openTab(event, 'productsTab')">Products</button>
            <button class="tab" onclick="openTab(event, 'shopTab')">Shop</button>
            <button class="tab" onclick="openTab(event, 'cartTab')">Cart</button>
        </div>
        
        <!-- Business Owner Registration -->
        <div id="businessTab" class="tab-content active">
            <h2>Business Registration</h2>
            <form id="businessForm">
                <input type="text" id="businessName" placeholder="Company Name" required>
                <input type="text" id="ownerName" placeholder="Owner Name" required>
                <input type="tel" id="businessPhone" placeholder="Phone Number" required>
                <input type="email" id="businessEmail" placeholder="Email" required>
                <input type="text" id="upiId" placeholder="PhonePe/UPI ID" required>
                <textarea id="businessAddress" placeholder="Business Address" required></textarea>
                <button type="submit">Register Business</button>
            </form>
            <div id="businessSuccess" class="hidden">
                <h3>Business Registered Successfully!</h3>
                <p>You can now add products to your store.</p>
            </div>
        </div>
        
        <!-- Customer Registration -->
        <div id="customerTab" class="tab-content">
            <h2>Customer Registration</h2>
            <form id="customerForm">
                <input type="text" id="customerName" placeholder="Full Name" required>
                <input type="tel" id="customerPhone" placeholder="Phone Number" required>
                <input type="email" id="customerEmail" placeholder="Email" required>
                <textarea id="deliveryAddress" placeholder="Delivery Address" required></textarea>
                <button type="submit">Register as Customer</button>
            </form>
            <div id="customerSuccess" class="hidden">
                <h3>Registration Successful!</h3>
                <p>You can now browse and shop products.</p>
            </div>
        </div>
        
        <!-- Product Management (Business Owner) -->
        <div id="productsTab" class="tab-content">
            <h2>Manage Products</h2>
            <form id="productForm">
                <input type="text" id="productName" placeholder="Product Name" required>
                <textarea id="productDescription" placeholder="Description" required></textarea>
                <input type="number" id="productPrice" placeholder="Price (₹)" min="0" step="0.01" required>
                <input type="number" id="productStock" placeholder="Stock Quantity" min="0" required>
                <input type="text" id="productImage" placeholder="Image URL">
                <button type="submit">Add Product</button>
            </form>
            <div id="productSuccess" class="hidden">
                <h3>Product Added Successfully!</h3>
            </div>
            
            <h3>Your Products</h3>
            <div id="businessProducts" class="product-grid"></div>
        </div>
        
        <!-- Shop (Customer View) -->
        <div id="shopTab" class="tab-content">
            <h2>Shop Products</h2>
            <input type="text" id="searchProduct" placeholder="Search products..." oninput="searchProducts()">
            <div id="allProducts" class="product-grid"></div>
        </div>
        
        <!-- Shopping Cart -->
        <div id="cartTab" class="tab-content">
            <h2>Your Shopping Cart</h2>
            <div id="cartItems"></div>
            <div id="cartTotal" class="cart-total">Total: ₹0.00</div>
            <button id="checkoutBtn" onclick="showPaymentForm()">Proceed to Checkout</button>
            
            <div id="paymentForm" class="payment-form hidden">
                <h3>Payment Details</h3>
                <p>You'll be redirected to PhonePe for payment</p>
                <div id="paymentDetails">
                    <p>Pay to: <span id="merchantUpi"></span></p>
                    <p>Amount: <span id="paymentAmount"></span></p>
                </div>
                <button onclick="processPayment()">Confirm Payment</button>
            </div>
            
            <div id="orderConfirmation" class="order-success hidden">
                <h2>Order Placed Successfully!</h2>
                <p>Thank you for your purchase.</p>
                <p>Your order will be delivered soon.</p>
            </div>
        </div>
    </div>

    <script>
        // Database variables
        let db;
        const DB_NAME = "ECommerceDB";
        const DB_VERSION = 1;
        
        // Object store names
        const BUSINESS_STORE = "businesses";
        const CUSTOMER_STORE = "customers";
        const PRODUCT_STORE = "products";
        const CART_STORE = "cart";
        
        // Current user variables
        let currentBusiness = null;
        let currentCustomer = null;
        
        // Initialize the database when the page loads
        window.onload = function() {
            initDB();
            loadBusinessProducts();
            loadAllProducts();
            loadCart();
        };
        
        // Initialize IndexedDB
        function initDB() {
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            
            request.onerror = function(event) {
                console.error("Database error:", event.target.error);
            };
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                
                // Create object stores if they don't exist
                if (!db.objectStoreNames.contains(BUSINESS_STORE)) {
                    db.createObjectStore(BUSINESS_STORE, { keyPath: "phone" });
                }
                
                if (!db.objectStoreNames.contains(CUSTOMER_STORE)) {
                    db.createObjectStore(CUSTOMER_STORE, { keyPath: "phone" });
                }
                
                if (!db.objectStoreNames.contains(PRODUCT_STORE)) {
                    const productStore = db.createObjectStore(PRODUCT_STORE, { keyPath: "id", autoIncrement: true });
                    productStore.createIndex("businessPhone", "businessPhone", { unique: false });
                }
                
                if (!db.objectStoreNames.contains(CART_STORE)) {
                    db.createObjectStore(CART_STORE, { keyPath: "productId" });
                }
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                checkBusinessRegistration();
                checkCustomerRegistration();
            };
        };
        
        // Tab navigation
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        // Check if business is already registered
        function checkBusinessRegistration() {
            const transaction = db.transaction([BUSINESS_STORE], "readonly");
            const store = transaction.objectStore(BUSINESS_STORE);
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                if (event.target.result.length > 0) {
                    currentBusiness = event.target.result[0];
                    document.getElementById("businessSuccess").classList.remove("hidden");
                    document.getElementById("businessForm").classList.add("hidden");
                }
            };
        }
        
        // Check if customer is already registered
        function checkCustomerRegistration() {
            const transaction = db.transaction([CUSTOMER_STORE], "readonly");
            const store = transaction.objectStore(CUSTOMER_STORE);
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                if (event.target.result.length > 0) {
                    currentCustomer = event.target.result[0];
                    document.getElementById("customerSuccess").classList.remove("hidden");
                    document.getElementById("customerForm").classList.add("hidden");
                }
            };
        }
        
        // Business Registration Form
        document.getElementById("businessForm").addEventListener("submit", function(e) {
            e.preventDefault();
            
            const business = {
                name: document.getElementById("businessName").value,
                owner: document.getElementById("ownerName").value,
                phone: document.getElementById("businessPhone").value,
                email: document.getElementById("businessEmail").value,
                upiId: document.getElementById("upiId").value,
                address: document.getElementById("businessAddress").value
            };
            
            const transaction = db.transaction([BUSINESS_STORE], "readwrite");
            const store = transaction.objectStore(BUSINESS_STORE);
            const request = store.add(business);
            
            request.onsuccess = function() {
                currentBusiness = business;
                document.getElementById("businessSuccess").classList.remove("hidden");
                document.getElementById("businessForm").classList.add("hidden");
                alert("Business registered successfully!");
            };
            
            request.onerror = function(event) {
                console.error("Error adding business:", event.target.error);
                alert("Error registering business. Please try again.");
            };
        });
        
        // Customer Registration Form
        document.getElementById("customerForm").addEventListener("submit", function(e) {
            e.preventDefault();
            
            const customer = {
                name: document.getElementById("customerName").value,
                phone: document.getElementById("customerPhone").value,
                email: document.getElementById("customerEmail").value,
                address: document.getElementById("deliveryAddress").value
            };
            
            const transaction = db.transaction([CUSTOMER_STORE], "readwrite");
            const store = transaction.objectStore(CUSTOMER_STORE);
            const request = store.add(customer);
            
            request.onsuccess = function() {
                currentCustomer = customer;
                document.getElementById("customerSuccess").classList.remove("hidden");
                document.getElementById("customerForm").classList.add("hidden");
                alert("Customer registration successful!");
            };
            
            request.onerror = function(event) {
                console.error("Error adding customer:", event.target.error);
                alert("Error registering customer. Please try again.");
            };
        });
        
        // Add Product Form
        document.getElementById("productForm").addEventListener("submit", function(e) {
            e.preventDefault();
            
            if (!currentBusiness) {
                alert("Please register your business first.");
                return;
            }
            
            const product = {
                name: document.getElementById("productName").value,
                description: document.getElementById("productDescription").value,
                price: parseFloat(document.getElementById("productPrice").value),
                stock: parseInt(document.getElementById("productStock").value),
                image: document.getElementById("productImage").value || "https://via.placeholder.com/150",
                businessPhone: currentBusiness.phone,
                businessName: currentBusiness.name,
                createdAt: new Date().getTime()
            };
            
            const transaction = db.transaction([PRODUCT_STORE], "readwrite");
            const store = transaction.objectStore(PRODUCT_STORE);
            const request = store.add(product);
            
            request.onsuccess = function() {
                document.getElementById("productSuccess").classList.remove("hidden");
                document.getElementById("productForm").reset();
                loadBusinessProducts();
                setTimeout(() => {
                    document.getElementById("productSuccess").classList.add("hidden");
                }, 3000);
            };
            
            request.onerror = function(event) {
                console.error("Error adding product:", event.target.error);
                alert("Error adding product. Please try again.");
            };
        });
        
        // Load business products
        function loadBusinessProducts() {
            if (!currentBusiness) return;
            
            const transaction = db.transaction([PRODUCT_STORE], "readonly");
            const store = transaction.objectStore(PRODUCT_STORE);
            const index = store.index("businessPhone");
            const request = index.getAll(currentBusiness.phone);
            
            request.onsuccess = function(event) {
                const products = event.target.result;
                const container = document.getElementById("businessProducts");
                container.innerHTML = "";
                
                if (products.length === 0) {
                    container.innerHTML = "<p>No products added yet.</p>";
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement("div");
                    productCard.className = "product-card";
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <p class="price">₹${product.price.toFixed(2)}</p>
                        <p>Stock: ${product.stock}</p>
                        <button onclick="deleteProduct(${product.id})">Delete</button>
                    `;
                    container.appendChild(productCard);
                });
            };
        }
        
        // Load all products for customers
        function loadAllProducts() {
            const transaction = db.transaction([PRODUCT_STORE], "readonly");
            const store = transaction.objectStore(PRODUCT_STORE);
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const products = event.target.result;
                const container = document.getElementById("allProducts");
                container.innerHTML = "";
                
                if (products.length === 0) {
                    container.innerHTML = "<p>No products available.</p>";
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement("div");
                    productCard.className = "product-card";
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <p class="price">₹${product.price.toFixed(2)}</p>
                        <button onclick="addToCart(${product.id}, '${product.name}', ${product.price}, '${product.image}')">Add to Cart</button>
                    `;
                    container.appendChild(productCard);
                });
            };
        }
        
        // Search products
        function searchProducts() {
            const searchTerm = document.getElementById("searchProduct").value.toLowerCase();
            const transaction = db.transaction([PRODUCT_STORE], "readonly");
            const store = transaction.objectStore(PRODUCT_STORE);
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const products = event.target.result;
                const container = document.getElementById("allProducts");
                container.innerHTML = "";
                
                const filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) || 
                    product.description.toLowerCase().includes(searchTerm)
                );
                
                if (filteredProducts.length === 0) {
                    container.innerHTML = "<p>No products found.</p>";
                    return;
                }
                
                filteredProducts.forEach(product => {
                    const productCard = document.createElement("div");
                    productCard.className = "product-card";
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <p class="price">₹${product.price.toFixed(2)}</p>
                        <button onclick="addToCart(${product.id}, '${product.name}', ${product.price}, '${product.image}')">Add to Cart</button>
                    `;
                    container.appendChild(productCard);
                });
            };
        }
        
        // Delete a product
        function deleteProduct(productId) {
            if (!confirm("Are you sure you want to delete this product?")) return;
            
            const transaction = db.transaction([PRODUCT_STORE], "readwrite");
            const store = transaction.objectStore(PRODUCT_STORE);
            const request = store.delete(productId);
            
            request.onsuccess = function() {
                loadBusinessProducts();
                loadAllProducts();
            };
            
            request.onerror = function(event) {
                console.error("Error deleting product:", event.target.error);
                alert("Error deleting product. Please try again.");
            };
        }
        
        // Add to cart
        function addToCart(productId, productName, price, image) {
            if (!currentCustomer) {
                alert("Please register as a customer first.");
                openTab(event, 'customerTab');
                return;
            }
            
            const transaction = db.transaction([CART_STORE], "readwrite");
            const store = transaction.objectStore(CART_STORE);
            
            // Check if product already in cart
            const getRequest = store.get(productId);
            
            getRequest.onsuccess = function(event) {
                const item = event.target.result;
                const quantity = item ? item.quantity + 1 : 1;
                
                const cartItem = {
                    productId,
                    name: productName,
                    price,
                    image,
                    quantity
                };
                
                const putRequest = store.put(cartItem);
                
                putRequest.onsuccess = function() {
                    loadCart();
                };
                
                putRequest.onerror = function(event) {
                    console.error("Error adding to cart:", event.target.error);
                };
            };
        }
        
        // Load cart items
        function loadCart() {
            const transaction = db.transaction([CART_STORE], "readonly");
            const store = transaction.objectStore(CART_STORE);
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const cartItems = event.target.result;
                const container = document.getElementById("cartItems");
                const totalElement = document.getElementById("cartTotal");
                container.innerHTML = "";
                
                if (cartItems.length === 0) {
                    container.innerHTML = "<p>Your cart is empty.</p>";
                    totalElement.textContent = "Total: ₹0.00";
                    document.getElementById("checkoutBtn").style.display = "none";
                    return;
                }
                
                document.getElementById("checkoutBtn").style.display = "block";
                
                let total = 0;
                
                cartItems.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItemElement = document.createElement("div");
                    cartItemElement.className = "cart-item";
                    cartItemElement.innerHTML = `
                        <div>
                            <img src="${item.image}" alt="${item.name}" style="width:50px;height:50px;object-fit:cover;">
                            <span>${item.name}</span>
                        </div>
                        <div>
                            <span>₹${item.price.toFixed(2)} x ${item.quantity} = ₹${itemTotal.toFixed(2)}</span>
                            <button onclick="updateCartItem(${item.productId}, ${item.quantity - 1})">-</button>
                            <button onclick="updateCartItem(${item.productId}, ${item.quantity + 1})">+</button>
                            <button onclick="removeFromCart(${item.productId})">Remove</button>
                        </div>
                    `;
                    container.appendChild(cartItemElement);
                });
                
                totalElement.textContent = `Total: ₹${total.toFixed(2)}`;
            };
        }
        
        // Update cart item quantity
        function updateCartItem(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            const transaction = db.transaction([CART_STORE], "readwrite");
            const store = transaction.objectStore(CART_STORE);
            const getRequest = store.get(productId);
            
            getRequest.onsuccess = function(event) {
                const item = event.target.result;
                if (item) {
                    item.quantity = newQuantity;
                    store.put(item).onsuccess = loadCart;
                }
            };
        }
        
        // Remove from cart
        function removeFromCart(productId) {
            const transaction = db.transaction([CART_STORE], "readwrite");
            const store = transaction.objectStore(CART_STORE);
            store.delete(productId).onsuccess = loadCart;
        }
        
        // Show payment form
        function showPaymentForm() {
            if (!currentBusiness) {
                alert("No business registered to process payment.");
                return;
            }
            
            const transaction = db.transaction([CART_STORE], "readonly");
            const store = transaction.objectStore(CART_STORE);
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const cartItems = event.target.result;
                let total = 0;
                
                cartItems.forEach(item => {
                    total += item.price * item.quantity;
                });
                
                document.getElementById("merchantUpi").textContent = currentBusiness.upiId;
                document.getElementById("paymentAmount").textContent = `₹${total.toFixed(2)}`;
                document.getElementById("paymentForm").classList.remove("hidden");
            };
        }
        
        // Process payment (simulated)
        function processPayment() {
            // In a real app, this would redirect to PhonePe payment gateway
            // Here we'll just simulate a successful payment
            
            // Get business info to show in confirmation
            const businessTransaction = db.transaction([BUSINESS_STORE], "readonly");
            const businessStore = businessTransaction.objectStore(BUSINESS_STORE);
            const businessRequest = businessStore.getAll();
            
            businessRequest.onsuccess = function() {
                const business = businessRequest.result[0];
                
                // Clear the cart
                const cartTransaction = db.transaction([CART_STORE], "readwrite");
                const cartStore = cartTransaction.objectStore(CART_STORE);
                cartStore.clear().onsuccess = function() {
                    // Show confirmation
                    document.getElementById("paymentForm").classList.add("hidden");
                    document.getElementById("cartItems").innerHTML = "";
                    document.getElementById("cartTotal").textContent = "Total: ₹0.00";
                    document.getElementById("checkoutBtn").style.display = "none";
                    
                    const orderElement = document.getElementById("orderConfirmation");
                    orderElement.classList.remove("hidden");
                    
                    // You would typically save the order details to another object store here
                    // For simplicity, we're just showing a confirmation message
                };
            };
        }
    </script>
</body>
</html>